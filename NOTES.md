# ABC 工具使用

## Verilog 学习

> Verilog 是一种 **硬件描述语言**，用于 **数字电路的系统设计**。可以对 **算法级**、**门级**、**开关级** 等多种抽象设计层次进行建模。

### 基础语法

#### 格式

- 区分大小写。
- 每个语句以 **分号** 为结束符。
- **空白符** 没有实际意义，编译阶段可忽略。

#### 注释

与 `C` 一样，`//` **单行注释**，`/**/` **多行注释**。

#### 标识符与关键字

标识符首字母必须是 **字母** 或 **下划线**，其他字母可以是 **`a-z`**、**`A-Z`**、**`0-9`**、**`$`** 和 **`_`**。

`module`：模块开始定义。
`input`：输入端口定义。
`output`：输出端口定义。
`inout`：双向端口定义。
`parameter`：信号的参数定义。
`wire`：wire 信号定义。
`reg`：reg 信号定义。
`always`：产生 reg 信号语句的关键字。
`assign`：产生 wire 信号。
`begin`：语句的起始标志。
`end`：语句的结束标志。
`posedge/negedge`：时序电路的标志。
`case`：Case 语句的起始标记。
`default`：Case 语句的默认分支标志。
`endcase`：Case 语句结束标志。
`if`： if/else 语句标记。
`else`：if/else 语句标记。
`for`：for 语句标记。
`endmodule`：模块结束定义。

#### 数值种类

- `0`：逻辑 0 或 "假"。
- `1`：逻辑 1 或 "真"。
- `x` 或 `X`：未知，即信号数值不确定。在实际电路里，信号可能为 1 或 0。
- `z` 或 `Z`：高阻，常见于信号没有驱动时的逻辑结果。

#### 数值表示

- **整数** 格式是 `(位宽)'[基数格式]数值`，其中 `位宽` 代表占用多少个 `bit`，是可选的参数。而 `基数格式` 代表使用的进制，有十进制 `d` 或 `D`，十六进制 `h` 或 `H`，二进制 `b` 或 `B`，八进制 `o` 或 `O`。使用关键字 `integer` 来声明。

```Verilog
4'b1011        // 4 bit 二进制数值 -5
32'h3022_c0de  // 32 bit 十六进制数值，下划线是为了增强代码可读性
'd100          // 不指明位宽，由编译器自动分频位宽，常见为 32 bit
100 					 // 直接写数字，默认十进制表示
```

- **负整数** 通常在表示位宽的数字前面加一个减号 `-` 来表示。但整型数字的第一个 `bit` 代表是符号位，代表负数，所以 -15 在 5 位二进制表示可以是 `5'b10001`。

- **实数** 则主要用 **十进制** 和 **科学计数法** 来表示，如 `30.123` 或 `1.2e4`。使用关键字 `real` 来声明。

- **时间** 是当前仿真时间的特殊时间寄存器变量，使用关键字 `time` 来声明，调用系统函数 `$time` 来获取当前仿真时间。

#### 字符串表示

**双引号包裹**，**不能多行书写**。如 `str = "www.runoob.com"`。**转义字符** 和 `C` 语言类似。

#### 数据类型

- **线网（wire）** 表示 **硬件单元之间的物理连线**，由其连接的器件输出端连续驱动，例如 `wire interrupt` 和 `wire gnd = 1'b0`。
- **寄存器（reg）** 表示 **存储单元**，始终保持数据原有的值直到被 **改写**。例如 `reg clk_temp`。
- **向量** 是 `wire` 或 `reg` 的声明形式。如 `reg [2:32 - 1] gpio_data` 就代表 30 `bit` 位宽的线性变量 `gpio_data`，位宽范围是 `2:31` 且最高有效位是 2。以及 `bit+:width` 代表从起始 `bit` 位开始递增，位宽为 `width`，相应的 `bit-:width` 则是从起始 `bit` 位开始递减，位宽为 `width`。
- **参数** 用来表示 **常量**，使用关键字 `parameter` 声明，只能 **初始化赋值一次**。例如 `parameter i = 1`。

#### 表达式

由 **操作符** 和 **操作数** 构成，可以在出现数值的任何地方使用。

- **操作数**：常数，整数，实数，线网，寄存器，时间，位选，域选，存储器及函数调用等。
- **操作符**：算术，关系，等价，逻辑，按位，归约，移位，拼接，条件等。

**算术操作符** 包括 **双目操作符** 乘`*`，除`/`，加`+`，减`-`，求幂`**`，取模`%` 和 **单目操作符** 正`+`，负`-`，非`!`，按位取反`~`。

**关系操作符** 有 大于`>`，小于`<`，大于等于`>=`，小于等于`<=`。如果操作数中有一位是 `x` 或 `z`，则关系表达式结果为 `x`。

**等价操作符** 包括 逻辑相等`==`，逻辑不等`!=`，全等`===`，非全等`!==`。全等比较按位比较，因此可以比较包含 `x`或 `z` 的操作数。

**逻辑操作符** 包括 逻辑与`&&`，逻辑或`||`，逻辑非`!`。

**按位操作符** 包括 取反`~`，与`&`，或`|`，异或`^`，同或`~^`。

**归约操作符** 包括 归约与`&`，归约与非`~&`，归约或`|`，归约或非`~|`，归约异或`^`，归约同或`~^`。仅有一个操作数，逐位操作，最终产生一个 `1 bit` 结果。

**移位操作符** 包括 左移`<<`，右移`>>`，算术左移`<<<`，算术右移`>>>`。逻辑右移时，左边高位会补 0，算术右移时，左边高位会补符号位。

**拼接操作符** 是 `{,}`，用于将多个操作数拼接成新的操作数，信号间用逗号`,`隔开。

**条件操作符** 结构是 `condition_expression ? true_expression : false_expression`。用法和 `C` 语言一致。

#### 编译指令

以反引号 `` ` `` 开头，是 `Verilog` 系统编译指令，类似于 `C` 中 `#`。

```Verilog
Verilog:  `define  ===  #define  :C
Verilog:  `undef   // 取消之前宏定义
Verilog:  `ifdef   ===  #ifdef   :C
Verilog:  `elsif   // 配合 `ifdef 使用
Verilog:  `else    // 配合 `ifdef 使用
Verilog:  `endif   ===  #endif   :C
Verilog:  `include ===  #include :C
Verilog:  `timescale time_unit / time_precision   // 将时间单位与实际时间相关联
Verilog:  `default_nettype`   // 用于为隐式的线网变量指定为线网类型。
Verilog:  `resetall`   // 将所有的编译指令重新设置为缺省值。
Verilog:  `celldefine, `endcelldefine   // 将模块标记为单元模块
Verilog:  `unconnected_drive, `nounconnected_drive   // 正偏电路状态和反偏电路状态
```

#### 连续赋值

数据流建模赋值，针对 `wire` 类型变量。只能赋值一次，且会随时变化，相当于 `C++` 中取别名，使用关键字 `assign` 或直接初始化赋值。

```Verilog
wire A, B;
wire Cout = A & B;

wire Cout, A, B;
assign Cout = A & B;
```

#### 时延

用于控制任意操作数发生变化到语句左端赋予新值之间的时间延时。

```Verilog
// 普通时延，A&B计算结果延时 10 个单位时间赋值给Z
wire Z, A, B
assign #10 Z = A & B;
// 隐式时延，声明时使用
wire A, B
wire #10 Z = A & B;
// 声明时延，对该变量所有的连续赋值都会被推迟到指定的时间。
wire A, B;
wire #10 Z;
assign Z = A & B;
```

#### 过程结构和过程赋值

`initial` 语句从 **0 时刻** 开始执行，只 **执行一次**，多个 `initial` 块之间相互独立。如有多个语句，则需搭配 `begin` 和 `end` 使用。

`always` 语句是 **重复执行**，常用与仿真时钟的产生，信号行为的检测等。

在 `initial` 或 `always` 语句块中的赋值是 **过程赋值**，分为 **阻塞赋值**`=`，即顺序执行，多用于`initial` 中。 和 **非阻塞赋值**`<=`，即并行执行，多用于 `always` 中。

## 参考链接

[Verilog 教程](https://www.runoob.com/w3cnote/verilog-tutorial.html)